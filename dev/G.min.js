!function(t,e,i){typeof define==="function"&&define.amd?define(function(){return e.call(i)}):typeof module==="object"&&typeof module.exports==="object"?module.exports=i.call(e):e[t]=i.call(e)}("G",this,function(){var t={};(function(){var t=false,e=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(t){for(var e in t)if(e!=="initialize")this[e]=t[e];if(t&&t.initialize)t.initialize.apply(this)};this.Class.extend=function(i){var s=this.prototype;t=true;var n=new this;t=false;for(var r in i){n[r]=typeof i[r]=="function"&&typeof s[r]=="function"&&e.test(i[r])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);this._super=i;return n}}(r,i[r]):i[r]}function a(){if(!t&&this.initialize)this.initialize.apply(this,arguments)}a.prototype=n;a.prototype.constructor=a;a.extend=arguments.callee;return a}}).call(t);!function(t,e,i){typeof define==="function"&&define.amd?define(function(){return e.call(i)}):typeof module==="object"&&typeof module.exports==="object"?module.exports=i.call(e):e[t]=i.call(e)}("Emit",this,function(){var t=function(){};t.prototype={on:function(t,e){this._events=this._events||{};this._events[t]=this._events[t]||[];this._events[t].push(e)},one:function(t,e){this._events=this._events||{};this._events[t]=this._events[t]||[];this._events[t].push(["one",e])},off:function(t,e){this._events=this._events||{};if(t in this._events===false)return;if(this._events[t].splice(this._events[t].indexOf(e),1).length>0)return;for(var i=0;i<this._events[t].length;i++){if(typeof this._events[t][i]==="object"&&this._events[t][0]==="one"&&this._events[t][i][1]===e){this._events[t].splice(this._events[t][i],1)}}},trigger:function(t){this._events=this._events||{};if(!this._events[t])return;var e=[];for(var i=0;i<this._events[t].length;i++){var s;if(typeof this._events[t][i]==="object"){s=this._events[t][i][1].apply(this,arguments[1]||undefined);this._events[t].splice(this._events[t][i],1)}else s=this._events[t][i].apply(this,arguments[1]||undefined);e.push(s)}return e}};t.mixin=function(e){var i=["on","one","off","trigger"];for(var s=0;s<i.length;s++){if(typeof e==="function"){e.prototype[i[s]]=t.prototype[i[s]]}else{e[i[s]]=t.prototype[i[s]]}}};return t});var e=function(){var t=this;var e=t;var i=t.events={move:["mousemove","touchmove"],down:["mousedown","touchstart"],up:["mouseup","touchend"]};function s(t){var e=arguments.length>2&&typeof arguments[1]==="object"?arguments[1]:window;var i=arguments.length===2?arguments[1]:typeof arguments[1]==="function"?arguments[1]:typeof arguments[2]==="function"?arguments[2]:arguments[3];var s=false;for(var n=0;n<arguments.length;n++)if(arguments[n]===true)s=true;if(typeof arguments[0]==="undefined")return false;if(typeof i==="undefined"){console.warn("No callback specified. Not listening for event.");return false}if(typeof e.addEventListener==="undefined"){console.warn("Invalid DOM object. Not listening for event.",arguments[1]);return false}var r=this.events||r;if(Array.isArray(t)||typeof t==="string"&&t.split(",").length>1||t in r){if(typeof t==="string")t=t.split(",");for(var n=0;n<t.length;n++){if(t[n]in r){var a=r[t[n]];for(var o=0;o<a.length;o++){if(o===0)t.splice(n,1,a[o]);else t.splice(n,0,a[o])}}}}function h(t,e,i,s,n,r){if(!Array.isArray(i)&&(typeof i==="object"||typeof i==="string"&&i.split(",").length===1)){if(e==="one")s[t](i,a,r);else s[t](i,n,r);function a(t){n.apply(this,arguments);s.removeEventListener(i,a)}}else{if(typeof i==="string")i=i.split(",");for(var o=0;o<i.length;o++){h(t,e,i[o],s,n,r)}}}return{run:h,el:e,callback:i,event:t,useCapture:s}}t.on=function(t){var e=s.apply(this,arguments);if(!e)return false;e.run("addEventListener","on",e.event,e.el,e.callback,e.useCapture)};t.one=function(t){var e=s.apply(this,arguments);if(!e)return false;e.run("addEventListener","one",e.event,e.el,e.callback,e.useCapture)};t.off=function(t){var e=s.apply(this,arguments);if(!e)return false;e.run("removeEventListener","off",e.event,e.el,e.callback)};t.key=function(){var t={};var e;t.setRoot=function(i){if(typeof i.addEventListener!=="function")console.warn("Invalid root, setting to window.");e=typeof i.addEventListener==="function"?i:typeof window.addEventListener==="function"?window:"nosupport";if(typeof e==="undefined")throw new Error("Key must be run in a browser");if(e==="nosupport")throw new Error("Key must be run in a browser with support for addEventListener. IE8 and below, and similar old browsers are not supported.");return t};t.setRoot(window);t.separator=",";var i=t.state={up:{},down:{}};var s=t.map={};var n={shift:["⇧"],alt:["option","⌥"],ctrl:navigator.userAgent.indexOf("Macintosh")!==-1?["control","⌃"]:["control","⌃","meta"],cmd:navigator.userAgent.indexOf("Macintosh")!==-1?["command","⌘","meta"]:["command","⌘"]};var r={shiftKey:16,altKey:18,ctrlKey:17,metaKey:navigator.userAgent.indexOf("Macintosh")!==-1?91:18};var a={16:["shift","⇧"],18:["alt","option","⌥"],17:["ctrl","control","⌃"],91:["cmd","command","⌘"],8:"backspace",9:"tab",12:"clear",13:"enter",13:"return",27:"esc",27:"escape",32:"space",37:"left",38:"up",39:"right",40:"down",46:"delete",36:"home",35:"end",33:"pageup",34:"pagedown",188:",",190:".",191:"/",192:"`",189:"-",187:"=",186:";",222:"'",219:"[",221:"]",220:"\\"};(function(){var s=e;var n={down:function(e){var s=t.toString(e.keyCode);if(!Array.isArray(s))s=[s];for(var n=0;n<s.length;n++){i.down[s[n]]=true;i.up={}}if(e.metaKey)i.down.meta=true},up:function(e){var s=t.toString(e.keyCode);if(!Array.isArray(s))s=[s];for(var n=0;n<s.length;n++){i.up[s[n]]=true;delete i.down[s[n]]}if(!e.metaKey)delete i.down.meta;if(s[0]==="cmd"||s[0]==="ctrl")i.down={}}};e.removeEventListener("keydown",n.down);e.removeEventListener("keyup",n.up);e.addEventListener("keydown",n.down,true);e.addEventListener("keyup",n.up,true);return t})();t.toString=function(t){var e=String.fromCharCode(t);if(e&&!a[t])var i=e.toLowerCase();else var i=a[t];return i};function o(t){var e=[];for(var i=0,s=t.length;i<s;i++){var n=Object.prototype.toString.call(t[i]).split(" ").pop().split("]").shift().toLowerCase();if(n){e=e.concat(/^(array|collection|arguments|object)$/.test(n)?o(t[i]):t[i])}}return e}function h(t){var e=[];for(var i in t)if(t[i]!==undefined)e.push(t[i]);return e}function f(t,e){if(Array.isArray(e)){for(var i=0;i<e.length;i++)if(f(t,e[i]))return true;return false}else{return Array.isArray(t)?o(t).indexOf(e)!==-1:t[e]?true:false}}function l(e,o,l){if(!e){if(l){var u=[];var c=[a[r["metaKey"]],a[r["ctrlKey"]],a[r["shiftKey"]],a[18]];if(!f(i[o],c)&&!("meta"in i[o]))for(var p in i[o])u.push(p);else{for(var p in c)if(f(i[o],c[p])&&!f(u,c[p])){u.push(c[p][0])}for(var p in i[o])if(!f([c,"meta"],p))u.push(p)}l.keys=u.join("+")}return true}var u=typeof e==="string"?e.split(t.separator):e;for(var p=0;p<u.length;p++)if(u[p].split("+").length>1)u[p]=u[p].split("+");if(u.length>1){for(var p=0;p<u.length;p++)if(d(u[p]))return true;return false}else return d(u[0]);function d(e,u){if(!u&&s[e]){function c(t){var e=[];if(Array.isArray(s[t]))_.each(s[t],function(t){e.push(t)});else if(typeof s[t]==="string")e.push(s[t]);if(e.length!==0)t=e;return t}if(!Array.isArray(e))e=c(e);else e=e.map(function(t,e){return c(t)});if(Array.isArray(e)){for(var p=0;p<e.length;p++){if(Array.isArray(e[p])){for(var v=0;v<e[p].length;v++)if(d(e[p][v],true))return true}else if(d(e[p],true))return true}return false}}if(l)l.keys=h(Object.keys(i[o]).map(function(t){for(var e in n){if(n[e].indexOf(t)!==-1)return undefined}return t})).join("+");if(l&&(l.metaKey||l.ctrlKey||l.shiftKey)&&!f(e,[a[r["metaKey"]],a[r["ctrlKey"]],a[r["shiftKey"]]]))return false;if(l&&l.metaKey&&f(e,a[r["metaKey"]])&&!f(e,t.toString(l.keyCode)))return false;if(Array.isArray(e)&&e.length===1)return d(e[0]);else if(typeof e==="string"&&(!l||t.toString(l.keyCode)===e)){return e in i[o]}else if(typeof e==="string"&&t.toString(l.keyCode)!==e){return false}else if(Array.isArray(e)){for(var p=0;p<e.length;p++)if(!(e[p]in i[o]))return false}return true}}t.isDown=function(t,e){return l(t,"down",e)};t.isUp=function(t,e){return l(t,"up",e)};t.on=function(i,s){if(i.indexOf("keydown")!==-1&&i.indexOf("keyup")!==-1){var n="keyup"+i.split(t.separator+"keyup")[1];var r=i.split(t.separator+"keyup")[0];if(typeof n==="string")t.on(n,s);if(typeof r==="string")t.on(r,s)}else{var a=i.split(":").length===1?i==="keyup"?"keyup":"keydown":i.split(":")[0];var o=i.split(":").length>1?i.split(":")[1]:i==="keydown"||i==="keyup"?false:i;e.addEventListener(a,function(e){var i=a==="keydown"?t.isDown(o,e):t.isUp(o,e);if(i)s(e)})}};t.one=function(i,s){if(i.indexOf("keydown")!==-1&&i.indexOf("keyup")!==-1){var n="keyup"+i.split(t.separator+"keyup")[1];var r=i.split(t.separator+"keyup")[0];if(typeof n==="string")t.on(n,s);if(typeof r==="string")t.on(r,s)}else{var a=i.split(":").length===1?"keydown":i.split(":")[0];var o=i.split(":").length>1?i.split(":")[1]:i==="keydown"||i==="keyup"?false:i;e.addEventListener(a,h);function h(i){var n=a==="keydown"?t.isDown(o,i):t.isUp(o,i);if(n){s(i);e.removeEventListener(a,h)}}}};t.off=function(t,i){e.removeEventListener(t,i)};return t}();t.mouse=function(){var t={};var i;t.setRoot=function(e){if(typeof e==="undefined"||typeof e.addEventListener!=="function")console.warn("Invalid root, setting to window.");i=typeof e!=="undefined"&&typeof e.addEventListener==="function"?e:typeof window.addEventListener==="function"?window:"nosupport";if(typeof i==="undefined")throw new Error("Mouse must be run in a browser");if(i==="nosupport")throw new Error("Mouse must be run in a browser with support for addEventListener. IE8 and below, and similar old browsers are not supported.");return t};t.setRoot(window);t.root=i;t.state={moving:false,down:false,up:true,left:false,right:false,x:0,y:0,pos:{x:0,y:0,window:{x:0,y:0},screen:{x:0,y:0},last:{x:0,y:0,window:{x:0,y:0},down:{x:0,y:0,window:{x:0,y:0}},up:{x:0,y:0,window:{x:0,y:0}}}}};t.events={move:["mousemove","touchmove"],down:["mousedown","touchstart"],up:["mouseup","touchend"]};var s={move:["mousemove","touchmove"],down:["mousedown","touchstart"],up:["mouseup","touchend"]};t.onlyTouch=function(){s.move=["touchmove"];s.down=["touchstart"];s.up=["touchend"];return t};t.onlyMouse=function(){s.move=["mousemove"];s.down=["mousedown"];s.up=["mouseup"];return t};t.run=function(e){var n=i;if(typeof e==="string")e=e.split(",");var e=typeof e==="object"?e:[];var r=t.state;var a={init:function(t){if(n!==i||e.indexOf(t.type)!==-1)return false;if(t.which===3||t.button===2)r.right=true;else r.left=true;if(t.changedTouches&&t.changedTouches[0]){var s=t.changedTouches[0].clientX;var a=t.changedTouches[0].clientY}else{var s=t.clientX;var a=t.clientY}r.pos.last.window.x=r.pos.window.x;r.pos.last.window.y=r.pos.window.y;r.pos.window.x=s;r.pos.window.y=a;if(i!==window){s=s-i.offsetLeft;a=a-i.offsetTop}if(r.x===s&&r.y===a)return false;r.pos.last.x=r.x;r.pos.last.y=r.y;r.x=r.pos.x=s;r.y=r.pos.y=a;r.pos.screen.x=t.screenX;r.pos.screen.y=t.screenY;return true},move:function(t){if(!a.init(t))n.removeEventListener(t.type,a.move);r.moving=true;var e=20;setTimeout(function(){if(r.moving)r.moving=false},e)},down:function(t){r.right=false;r.left=false;if(!a.init(t))n.removeEventListener(t.type,a.down);r.down=true;r.up=false;r.pos.last.down.x=r.x;r.pos.last.down.y=r.y;r.pos.last.down.window.x=r.pos.window.x;r.pos.last.down.window.y=r.pos.window.y},up:function(t){if(!a.init(t))n.removeEventListener(t.type,a.up);r.down=false;r.up=true;r.pos.last.up.x=r.x;r.pos.last.up.y=r.y;r.pos.last.down.window.x=r.pos.window.x;r.pos.last.down.window.y=r.pos.window.y}};for(var o in s){for(var h in s[o]){i.removeEventListener(s[o][h],a[o]);i.addEventListener(s[o][h],a[o],true)}}return t};function n(t){Array.prototype.splice.call(t,1,0,i);return t}t.on=function(){e.on.apply(t,n(arguments));return t};t.one=function(){e.one.apply(t,n(arguments));return t};t.off=function(){e.off.apply(t,n(arguments));return t};return t}()};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(t,e){var i,s;pivot=e?e:0,length;if(!this){throw new TypeError}length=this.length;if(length===0||pivot>=length){return-1}if(pivot<0){pivot=length-Math.abs(pivot)}for(i=pivot;i<length;i++){if(this[i]===t){return i}}return-1}}(function(){var t=0;var e=["webkit","moz"];for(var i=0;i<e.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[e[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e[i]+"CancelAnimationFrame"]||window[e[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(e,i){var s=(new Date).getTime();var n=Math.max(0,16-(s-t));var r=window.setTimeout(function(){e(s+n)},n);t=s+n;return r};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(t){clearTimeout(t)}})();Object.keys=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)(t,i))e.push(i);return e};var i=function(){var t=Date.now(),e=t,i=0,s=1/0,n=0,r=0,a=1/0,o=0,h=0,f=0,l=document.createElement("div");l.id="stats",l.addEventListener("mousedown",function(t){t.preventDefault(),v(++f%2)},!1),l.style.cssText="width:80px;opacity:0.9;cursor:pointer";var u=document.createElement("div");u.id="fps",l.appendChild(u);var c=document.createElement("div");c.id="fpsText",c.innerHTML="FPS",u.appendChild(c);var p=document.createElement("div");p.id="ms",p.style.cssText="display:none",l.appendChild(p);var d=document.createElement("div");d.id="msText",d.innerHTML="MS",p.appendChild(d);var v=function(t){switch(f=t){case 0:u.style.display="block",p.style.display="none";break;case 1:u.style.display="none",p.style.display="block"}};return{REVISION:11,domElement:l,setMode:v,begin:function(){t=Date.now()},end:function(){var f=Date.now();return i=f-t,s=Math.min(s,i),n=Math.max(n,i),d.textContent=i+" MS ("+s+"-"+n+")",h++,f>e+1e3&&(r=Math.round(1e3*h/(f-e)),a=Math.min(a,r),o=Math.max(o,r),c.textContent=r+" FPS ("+a+"-"+o+")",e=f,h=0),f},update:function(){t=this.end()}}};(function(){var t=this;if(t._)return t._;var e={};var i=function(t){if(t instanceof i)return t;if(!(this instanceof i))return new i(t);this._wrapped=t};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=i}exports._=i}else{t._=i}i.each=function(t,s,n){if(t==null)return;if(Array.prototype.forEach&&t.forEach===Array.prototype.forEach){t.forEach(s,n)}else if(t.length===+t.length){for(var r=0,a=t.length;r<a;r++){if(s.call(n,t[r],r,t)===e)return}}else{var o=i.keys(t);for(var r=0,a=o.length;r<a;r++){if(s.call(n,t[o[r]],o[r],t)===e)return}}};i.flatten=function(t){var e=[];for(var i=0,s=t.length;i<s;i++){var n=Object.prototype.toString.call(t[i]).split(" ").pop().split("]").shift().toLowerCase();if(n){e=e.concat(/^(array|collection|arguments|object)$/.test(n)?flatten(t[i]):t[i])}}return e};i.contains=function(t,e){if(Array.isArray(e)){for(var i=0;i<e.length;i++)if(contains(t,e[i]))return true;return false}else{return Array.isArray(t)?flatten(t).indexOf(e)!==-1:t[e]?true:false}};i.clone=function(t){if(t instanceof Array)return t.slice(0);return i.extend({},t)};i.has=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};i.keys=Object.keys||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var s in t)if(i.has(t,s))e.push(s);return e};i.extend=function(t){i.each(Array.prototype.slice.call(arguments,1),function(e){if(e){for(var i in e){t[i]=e[i]}}});return t};var s=function(t,e,n,r){if(t===e)return t!==0||1/t==1/e;if(t==null||e==null)return t===e;if(t instanceof i)t=t._wrapped;if(e instanceof i)e=e._wrapped;var a=toString.call(t);if(a!=toString.call(e))return false;switch(a){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:t==0?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if(typeof t!="object"||typeof e!="object")return false;var o=n.length;while(o--){if(n[o]==t)return r[o]==e}var h=t.constructor,f=e.constructor;if(h!==f&&!(i.isFunction(h)&&h instanceof h&&i.isFunction(f)&&f instanceof f)){return false}n.push(t);r.push(e);var l=0,u=true;if(a=="[object Array]"){l=t.length;u=l==e.length;if(u){while(l--){if(!(u=s(t[l],e[l],n,r)))break}}}else{for(var c in t){if(i.has(t,c)){l++;if(!(u=i.has(e,c)&&s(t[c],e[c],n,r)))break}}if(u){for(c in e){if(i.has(e,c)&&!l--)break}u=!l}}n.pop();r.pop();return u};i.isEqual=function(t,e){return s(t,e,[],[])};i.omit=function(t){var e={};var s=Array.prototype.concat.apply(Array.prototype,Array.prototype.slice.call(arguments,1));for(var n in t){if(!i.contains(s,n))e[n]=t[n]}return e}}).call(this);t.animate=function(e){t.stage.animate(e);t.stage.on("animate",function(){t.framerate=t.stage.framerate;t.deltaFramerate=t.stage.deltaFramerate;t.deltaTime=t.stage.deltaTime;t.desiredFramerate=t.stage.desiredFramerate;t.trigger("animate",arguments)});return this};t.pause=function(){if(t.stage.pause()!==false){t.isPaused=true;t.trigger("pause",arguments)}return this};t.unPause=function(){t.stage.unPause();t.isPaused=false;t.trigger("unpause",arguments);return this};t.togglePaused=function(){if(t.isPaused)t.unPause();else t.pause();return this};t.update=function(){if(t.stage.length()===0)return false;t.trigger("update");t.stage.update();_.each(t.collections,function(t){t.update()});return this};t.render=function(e){if(t.stage.length()===0)return false;t.trigger("render");t.stage.render(e);return this};t.setCanvas=function(){if(!t.stage){new t.Stage;t.stage.event=t.event}t.stage.setCanvas.apply(t.stage,arguments);this.canvas=t.stage.canvas;this.ctx=t.stage.ctx;if(t.showFramerate)t.stage.showFramerate=true;if(typeof t.desiredFramerate==="number")t.stage.desiredFramerate=t.desiredFramerate;t.framerate=t.stage.framerate;t.deltaFramerate=t.stage.deltaFramerate;t.deltaTime=t.stage.deltaTime;t.desiredFramerate=t.stage.desiredFramerate};t.clearCanvas=function(){if(this.canvas&&this.ctx)this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)};t.getCanvas=function(){return this.canvas||(t.stage?t.stage.canvas:false)};t.getContext=function(){return this.ctx||(t.stage?t.stage.canvas:false)};t.Collection=t.Class.extend({initialize:function(e,i,s){this.objects=[];this._currentId=0;this.addToCollections=typeof e==="boolean"?e:typeof e==="object"&&typeof e.addToCollections==="boolean"?e.addToCollections:true;this.addToShapeCollections=typeof i==="boolean"?i:typeof addToSCollections==="object"&&typeof e.addToShapeCollections==="boolean"?e.addToShapeCollections:true;this.add.apply(this,arguments);if(this.addToCollections!==false){t.collections.push(this);this._initLoader()}this.events=true;var n=this.addToCollections;if(n&&typeof n.events!=="undefined"&&!n.events)this.events=false;if(s||typeof this.addToCollections==="object"&&this.addToCollections.physics){this.physics=true;this.world=new t.Physics.World(e)}},_initLoader:function(){var e=this;var i=new t.Collection(false,false),s=new t.Collection(false,false);this.loaded=true;this.on("add",function(t){if(t.src){i.add(t);if(!t.loaded){e.loaded=false;t.on("load",function(){s.add(t);n(t)})}else s.add(t);n(t)}});function n(n){if(i.length()===s.length()){e.loaded=true;if(e.events)e.trigger("load",[i]);if(e===t.stage&&t.events)t.trigger("load",[i])}else{if(e.events)e.trigger("loading",[i.query({loaded:false}),s,i]);if(e===t.stage&&t.events)t.trigger("loading",[i.query({loaded:false}),s,i])}}},update:function(){if(this.world&&(this!==t.stage&&this.physics||this===t.stage&&t.physics&&this.physics))this.world.update();else this.each(function(t){if(t.update)t.update()});return this},render:function(){if(this.isPaused)return;var t=this;if(t.events)t.trigger("render");for(var e=0;e<this.objects.length;e++){var i=this.objects[e];if(!i)continue;if(t.events)t.trigger("renderShape",[i]);i.render()}return this},add:function(e){if(arguments.length>1){for(var i=0;i<arguments.length;i++){if(arguments[i]instanceof Array||arguments[i]instanceof t.Shape)this.add(arguments[i])}}else if(e instanceof Array){for(var i=0;i<e.length;i++){if(e[i]instanceof t.Shape)this.add(e[i])}}else{if(!(e instanceof t.Shape))return false;if(this.world&&this.physics!==false)this.world.add(e);if(this.has(e)){return false}if(!(e instanceof t.Shape))return false;var s=this._currentId;this.objects[s]=e;this._currentId++;this._length=this._length+1||1;if(e.collections&&this.addToShapeCollections!==false&&e.collections.indexOf(this)===-1)e.collections.push(this);if(this instanceof t.Stage)e.stage=this;if(this.events)this.trigger("add",arguments);if(this.events)this.trigger("change",arguments);return s}},remove:function(e,i){if(this.length()===0)return false;if(typeof e==="number")e=this.get(e);if(e instanceof t.Shape&&!this.has(e))return false;var s=this;if(!e||typeof e==="boolean"){var n=0;var r=[];this.each(function(t){r.push(t);s.remove(t);if(t)t.remove()});return r}if(this.world&&this.physics!==false)this.world.remove(e);var n=this.getId(e);if(this.events)this.trigger("remove",arguments);if(this.events)this.trigger("change",arguments);delete this.objects[n];this._length=this._length-1||0;if(!e.collections||e.collections&&e.collections.length===0)return e;var n=e.collections.indexOf(this);if(n!==-1){e.collections.splice(n,1);if(!i&&e.events)e.trigger("remove",this)}if(this===t.stage||this.queryParent===t.stage)e.remove();return e},has:function(t){if(t instanceof Array)var e=t.map(function(t){return this.has(t)},this);else e=this.objects.indexOf(t)!==-1;return e},get:function(t){if(typeof t==="number"){if(t>=0)return this.objects[t];return this.objects[this.objects.length+t]}if(this.objects.indexOf(undefined)===-1)return this.objects.slice(0);var e=[];for(var i=0;i<this.objects.length;i++){var s=this.objects[i];if(s)e.push(s)}return e},getId:function(t){return this.objects.indexOf(t)},each:function(t){for(var e=0;e<this.objects.length;e++){if(typeof this.objects[e]!=="undefined"){var i=t.call(this,this.objects[e]);if(i===false)break}}return this},length:function(){if(!isNaN(this._length))return this._length;if(this.objects.indexOf(undefined)===-1)return this.objects.length;var t=0;for(var e=0;e<this.objects.length;e++){if(typeof this.objects[e]!=="undefined")t++}return t},shapeContainingPoint:function(t,e,i){var s;this.each(function(n){if(n.posInBounds(t,e,i))s=n;return false});if(s){return s}return false},getIntersections:function(){var e=this,i=function(){},s=true,n=[];for(var r=0;r<arguments.length;r++){if(arguments[r]instanceof t.Collection)e=arguments[r];if(typeof arguments[r]==="function")i=arguments[r]}this.each(function(t){var r=t.getIntersections(e,i);if(r){n.push([t,r]);s=false}});if(s)return false;return n},query:function(e,i){if(typeof e!=="string"&&typeof e!=="object"&&typeof e!=="function")return false;if(typeof e==="string")var s=e.split(",");if(typeof e==="function")var n=e;var i=i||function(){};var r=new t.Collection(false,false);r.queryParent=this;var a=true;this.each(function(t){var o=false;if(s){for(var h=0;h<s.length;h++){if(typeof t[s[h]]==="undefined")o=true}}else if(n)o=n(t)?false:true;else _.each(e,function(e,i){if(typeof e==="object")_.each(e,function(e,s){f(e,s,t[i])});else f(e,i,t)});function f(t,e,i){if(!i)return;var s=false;if(typeof t==="string"&&t.indexOf("range")!==-1){var s=t.split("range:").join("").split(":").map(function(t){return parseFloat(t)});if(s&&i[e]>=s[0]&&i[e]<=s[1])o=false;else o=true}if(!s&&i[e]!==t)o=true}if(!o){i(t,e);r.add(t);a=false}});return r}});t.config=function(e){if(typeof e!=="object")return false;if(e.physics){if(typeof e.physics==="boolean")t.physics=e.physics;else if(typeof e.physics==="object"){t.physics=true;if(typeof e.physics.gravity==="number")t.gravity=new t.Vector(t.gravity?t.gravity.x:0,e.physics.gravity);if(typeof e.physics.gravity==="object")t.gravity=new t.Vector(e.physics.gravity.x,e.physics.gravity.y);if(typeof e.physics.cellSize==="number")t.cellSize=e.physics.cellSize}}if(typeof e.showFramerate==="boolean"){t.showFramerate=e.showFramerate;if(t.stage)t.stage.showFramerate=e.showFramerate}};t.Object=t.Class.extend({initialize:function(t,e){this.mergeValues(t,e);if(this.addToStage!==false)this.add(this.addToCollection);if(this.addToCollection)delete this.addToCollection},mergeValues:function(e,i){if(!e&&!i)return;e=JSON.parse(JSON.stringify(e));i=JSON.parse(JSON.stringify(i||{}));var s={collections:[],events:true};var n=s;var i=i||{};n=_.extend(n,i,e);for(var r in n){if(typeof e[r]!=="undefined"){if(typeof e[r]==="object"&&typeof n[r]==="object"){for(var a in e[r]){n[r][a]=e[r][a]}}else n[r]=e[r]}if(typeof n[r]==="object"&&n[r].x&&n[r].y&&_.keys(n[r]).length===2)this[r]=new t.Vector(n[r].x,n[r].y);else this[r]=n[r]}},add:function(e){if(e===false)return false;if(e&&e instanceof t.Collection){var i=e.add(this);if(typeof i==="number"){if(this.events)this.trigger("add",e);if(e.addToShapeCollections!==false&&this.collections.indexOf(e)===-1)this.collections.push(e)}}else if(this.collections&&this.collections.length>0){_.each(this.collections,function(t,e){var i=t.add(this);if(typeof i==="number"){if(this.events)this.trigger("add",t)}},this)}if(t.stage&&this.addToStage!==false&&t.stages.length===1){var i=t.stage.add(this);if(typeof i==="number"&&this.events){if(this.events)this.trigger("add",t.stage);if(t.stage.addToShapeCollections!==false&&this.collections.indexOf(t.stage)===-1)this.collections.push(t.stage)}if(typeof i!=="undefined")this.stageId=i}},remove:function(e){var i=this;if(e&&e instanceof t.Collection){var s=e.remove(this);if(typeof s==="number"&&this.events)this.trigger("remove",e)}else if(this.collections&&this.collections.length>0){_.each(this.collections,function(t,e){var s=t.remove(i);if(typeof s==="number"&&i.events)i.trigger("remove",t)})}if(!e&&this.stage){var s=this.stage.remove(this);if(typeof s==="number"&&this.events)this.trigger("remove",this.stage)}},set:function(t,e){var i=this;if(typeof t==="object"){_.each(arguments[0],function(t,e){i.set(e,t)});return}var s=this[t];if(typeof e!=="object"&&e!==s||typeof e==="object"&&!_.isEqual(s,e)){if(typeof e==="object")this[t]=_.extend(s,e);else this[t]=e;if(this.events){this.trigger("change",[s,t]);this.trigger("change:"+t,[s,t]);for(var n=0;n<this.colections.length;n++){if(this.collections[n].events){this.collections[n].trigger("change:any",[s,t]);this.collections[n].trigger("change:"+t,[s,t])}}}return s}return false},get:function(t){if(typeof this[t]==="undefined")return false;if(typeof this[t]==="object")return _.clone(obj);return this[t]}});var s=t.Shape=t.Object.extend({mergeValues:function(t,e){var e=_.extend({pos:{x:0,y:0},vel:{x:0,y:0},width:0,height:0,rotation:0,color:"#000",fill:true,hidden:false,_bounds:{top:1,left:1,right:1,bottom:1}},e||{});this._super(t,e)},bounds:function(t){if(t){if(typeof t!=="object")return;for(var e in t){if(e==="top"){this.pos.y=t[e]+this.height/2;this._bounds[e]=t[e]}else if(e==="bottom"){this.pos.y=t[e]-this.height/2;this._bounds[e]=t[e]}else if(e==="left"){this.pos.x=t[e]+this.width/2;this._bounds[e]=t[e]}else if(e==="right"){this.pos.x=t[e]-this.width/2;this._bounds[e]=t[e]}}}else{if(!this.width)return false;this._bounds.left=this.pos.x-this.width/2;this._bounds.right=this.pos.x+this.width/2;this._bounds.top=this.pos.y-this.height/2;this._bounds.bottom=this.pos.y+this.height/2;return this._bounds}},posInBounds:function(e,i){var s=.01,n=false;for(var r=2;r<arguments.length;r++){if(typeof arguments[r]==="number")var s=arguments[r];if(typeof arguments[r]==="boolean")n=arguments[r]}var a=this.bounds();if(this.shape==="rect")return e>a.left&&e<a.right&&i>a.top&&i<a.bottom;var o=new t.Circle({pos:{x:e,y:i},radius:s,addToStage:false,hidden:true});return t.intersecting(o,this,n)},getIntersections:function(){var e=t.stage,i=function(){},s=true,n=[];for(var r=0;r<arguments.length;r++){if(arguments[r]instanceof t.Stage||Array.isArray(arguments[r]))e=arguments[r];if(typeof arguments[r]==="function")i=arguments[r]}var a=this;if(Array.isArray(e))for(var r=0;r<e.length;r++)o(e[r]);else o(e);function o(e){e.each(function(e){var r=t.intersecting(e,a);if(r){i(r,e);n.push([r,e]);s=false}})}if(s)return false;return n},update:function(){this.trigger("update",[])},render:function(){if(typeof this.loaded!=="undefined"&&this.loaded===false)return;if(!this.isVisible())return;if(this.stage&&!this.stage.ctx||!t.stage.ctx)throw new Error("No canvas to render to.");if(this.events)this.trigger("render",arguments);if(t.events)t.trigger("renderShape",[this]);if(this.rotation!==0)this.rotate(this.rotation);else this._render();return this},rotate:function(e){var i=this.stage.ctx||t.stage.ctx;if(this.events)this.trigger("rotate",arguments);i.save();i.translate(this.pos.x,this.pos.y);i.rotate(e);this._render(0,0);i.restore()},hide:function(){if(this.events)this.trigger("hide",arguments);this.hidden=true},show:function(){if(this.events)this.trigger("show",arguments);this.hidden=false},toggleHidden:function(){if(this.hidden&&this.events)this.trigger("show",arguments);else if(this.events)this.trigger("hide",arguments);this.hidden=!this.hidden},isVisible:function(){if(this.hidden)return false;var e=this.bounds();if(!e)return true;return e.right>0&&e.left<(this.stage?this.stage.canvas.width:t.canvas.width)&&e.bottom>0&&e.top<(this.stage?this.stage.canvas.height:t.canvas.height)}});t.Stage=t.Collection.extend({initialize:function(i){if(t.stages.length===0){t.stage=this;this.name="G Main Stage"}this.objects=[];this.physics=false;this._currentId=0;this._length=0;this._initLoader();this.addToCollections=false;this.addToShapeCollections=false;this.events=true;if(i&&typeof i.events!=="undefined"&&!i.events)this.events=false;this.event=new e;this.framerate=this.desiredFramerate=60;this.timeScale=1;this.deltaFramerate=0;this.time=0;if(t.stage&&this===t.stage)this.showFramerate=t.showFramerate;this.stats._stage=this;if(i&&i.physics||t.stages.length===0&&t.physics){this.physics=true;this.world=new t.Physics.World(i)}this.backgroundColor="white";t.stages.push(this)},setCanvas:function(){var t=[];_.each(arguments,function(e){t.push(e)});for(var e=0;e<t.length;e++){var i=t[e];if(!this.canvas&&!this.ctx){if(t[e].tagName&&i.tagName==="CANVAS"){this.canvas=i}else if(typeof i==="string"){this.canvas=document.getElementById(i)}else{this.canvas=document.body.appendChild(document.createElement("canvas"))}this.ctx=this.canvas.getContext("2d")}if(typeof i==="number"&&this.canvas){if(typeof t[e+1]==="number"){this.canvas.width=t[e];this.canvas.height=t[e+1];e++}else this.canvas.width=t[e]}}if(!this.canvas&&!this.ctx){this.canvas=document.body.appendChild(document.createElement("canvas"));this.canvas.width=window.innerWidth;this.canvas.height=window.innerHeight;this.ctx=this.canvas.getContext("2d")}this.width=this.canvas.width;this.height=this.canvas.height;this.event.mouse.setRoot(this.canvas).run();this.clearCanvas();return this},clearCanvas:function(){if(this.canvas&&this.ctx){if(this.backgroundColor==="white")this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);else{this.ctx.fillStyle=this.backgroundColor;this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}return this},render:function(t){if(this.isPaused)return;if(t!==false)this.clearCanvas();this._super.apply(this,arguments);return this},animate:function(t){var e=this;if(typeof t==="function"){if(this._events.animate)return this.on("animate",t);this.on("animate",t)}this.trigger("animate",arguments);if(!this.time)this.time=Date.now();this.framerate=o(this.time);this.deltaTime=a(this.time);this.deltaFramerate=h(this.time,this.desiredFramerate,this.timeScale);this.time=Date.now();if(this.showFramerate===true&&!this.stats.stats)this.stats.create();else if(this.showFramerate&&this.stats.stats)this.stats.update();else if(!this.showFramerate&&this.stats.stats)this.stats.remove();if(!this.isPaused){if(this.desiredFramerate===60)window.requestAnimationFrame(function(t){e.animate.call(e,t)
});else window.setTimeout(function(t){e.animate.call(e,t)},1e3/this.desiredFramerate)}},pause:function(){this.isPaused=true;this.trigger("pause",arguments);return this},unPause:function(){if(typeof this.isPaused==="undefined")return false;this.isPaused=false;this.animate();this.trigger("unpause",arguments);return this},togglePaused:function(){if(this.isPaused)this.unPause();else this.pause();return this},stats:{create:function(){var t=this.stats=new i;this.el=t.domElement;document.body.appendChild(this.el);this.el.style.cssText="padding:3px;z-index:100;position:absolute;left:"+this._stage.canvas.scrollLeft+";top:"+this._stage.canvas.scrollTop+";cursor:pointer;background-color:#fff;font: 12px 'Helvetica Neue', Helvetica, Arial, sans-serif;"},update:function(){if(this.stats)this.stats.update()},remove:function(){if(this.el&&this.el.parentNode===document.body)document.body.removeChild(this.el)}}});t.Ticker=t.Class.extend({initialize:function(){this.interval=1e3/1;for(var t=0;t<arguments.length;t++){if(typeof arguments[t]==="function")this.on("tick",arguments[t]);if(typeof arguments[t]==="number")this.interval=arguments[t]}},start:function(t){var e=this;if(typeof t!=="number"&&this.isStopped===false)return;else if(typeof t!=="number"&&this.isStopped===true){this.isStopped=false;this._time=Date.now();this.trigger("start")}if(!this._time)this.trigger("start");if(!this._time)this._time=Date.now();if(!this.elapsedTime)this.elapsedTime=0;this.deltaTime=a(this._time);this.elapsedTime=parseFloat((this.elapsedTime+this.deltaTime/1e3).toFixed(3));this._time=Date.now();this.trigger("tick",arguments);if(!this.isStopped){if(this.interval===1e3/60)window.requestAnimationFrame(function(t){e.start.call(e,t)});else window.setTimeout(function(t){e.start.call(e,e.elapsedTime)},this.interval)}},stop:function(){this.isStopped=true;this.trigger("stop")},reset:function(){this.elapsedTime=0;this.trigger("reset")}});t.Rect=s.extend({initialize:function(t,e){if(typeof t!=="object"&&arguments.length>=4){var i={};i.pos={x:arguments[0],y:arguments[1]};if(arguments[2])i.width=arguments[2];if(arguments[3])i.height=arguments[3];if(typeof arguments[4]==="string")i.color=arguments[4];if(typeof arguments[5]==="number")i.vel={x:arguments[5]};if(typeof arguments[6]==="number"&&i.vel)i.vel.y=arguments[6];if(Array.prototype.indexOf.call(arguments,false)!==-1)i.addToStage=false;var t=arguments[0]=i}this.shape="rect";if(this._super)this._super.apply(this,arguments);if(this.pos.y>this.pos.y+this.height){this.pos.y=this.pos.y+this.height;this.height=Math.abs(this.height)}if(this.pos.x>this.pos.x+this.width){this.pos.x=this.pos.x+this.width;this.width=Math.abs(this.width)}},_render:function(e,i,s,n){var r=this.stage?this.stage.ctx:t.stage.ctx;if(!r)return;if(this.thickness)r.lineWidth=this.thickness;if(this.fill){r.fillStyle=this.color;if(e!==undefined&&i!==undefined)r.fillRect(e-this.width/2,i-this.width/2,this.width,this.height);else if(s!==undefined&&n!==undefined)r.fillRect(e-s/2,i-n/2,s,n);else r.fillRect(this.pos.x-this.width/2,this.pos.y-this.height/2,this.width,this.height)}else{r.strokeStyle=this.strokeColor||this.color;if(e!==undefined&&i!==undefined)r.strokeRect(e-this.width/2,i-this.width/2,this.width,this.height);else if(s!==undefined&&n!==undefined)r.strokeRect(e-s/2,i-n/2,s,n);else r.strokeRect(this.pos.x-this.width/2,this.pos.y-this.height/2,this.width,this.height)}}});t.Bounds=function(){return t.Collection.extend({initialize:function(e,i,s,n,r,a,o){this._super(false,true);this.thickness=o||2;if(arguments.length<4){if(arguments[0]){this.thickness=arguments[0]||this.thickness}e=0;i=0;s=t.stage.canvas?t.stage.canvas.width:0;n=t.stage.canvas?t.stage.canvas.height:0}var h=typeof h==="boolean"?h:true;this.friction=typeof r==="number"?r:0;this.restitution=typeof a==="number"?a:0;this.name="Bounds Shape";var f={pos:{x:(s+e)/2,y:i},width:s-e,height:this.thickness,type:"static",hidden:h,friction:this.friction,restitution:this.restitution};for(var l=0;l<arguments.length;l++)if(typeof arguments[l]==="string")var u=arguments[l].split(",");var c,p,d,v;if(!u||u.indexOf("top")===-1)c=new t.Rect(f);f.pos.x=e,f.pos.y=(n+i)/2,f.width=this.thickness,f.height=n-i;if(!u||u.indexOf("left")===-1)p=new t.Rect(f);f.pos.x=(s+e)/2,f.pos.y=n,f.width=s-e,f.height=this.thickness;if(!u||u.indexOf("bottom")===-1)d=new t.Rect(f);f.pos.x=s,f.pos.y=(n+i)/2,f.width=this.thickness,f.height=n-i;if(!u||u.indexOf("right")===-1)v=new t.Rect(f);this.add(c,p,d,v);var g=this;this.bounds={top:c,left:p,bottom:d,right:v};this.top=c;this.left=p;this.bottom=d;this.right=v},resize:function(){this.each(function(t){if(t.stage&&t.stage.world)t.stage.world.remove(t);t.remove()});this.initialize.apply(this,arguments)}})}();t.Circle=s.extend({initialize:function(t){if(typeof t!=="object"&&arguments.length>2){var e={};e.pos={x:arguments[0],y:arguments[1]};e.radius=arguments[2];if(typeof arguments[3]==="string")e.color=arguments[3];if(typeof arguments[4]==="number")e.vel={x:arguments[4]};if(typeof arguments[5]==="number"&&e.vel)e.vel.y=arguments[5];if(Array.prototype.indexOf.call(arguments,false)!==-1)e.addToStage=false;var t=arguments[0]=e}this.shape="circle";this.radius=t.radius;if(this._super)this._super.apply(this,arguments);this.width=this.height=this.radius*2},_render:function(e,i,s,n){var r=this.stage?this.stage.ctx:t.stage.ctx;if(!r)return;if(this.fill)r.fillStyle=this.color;else r.strokeStyle=this.strokeColor||this.color;if(this.thickness)r.lineWidth=this.thickness;if(e===undefined)var e=this.pos.x;if(i===undefined)var i=this.pos.y;if(s===undefined)var s=this.radius;r.beginPath();r.arc(e,i,s,0,Math.PI*2,false);if(this.fill)r.fill();else r.stroke();r.closePath()}});t.Image=t.Rect.extend({initialize:function(t){if(arguments.length>2){var e={};e.src=arguments[0];e.pos={x:arguments[1],y:arguments[2]};if(arguments[3])e.width=arguments[3];if(arguments[4])e.height=arguments[4];if(arguments[5])e.vel={x:arguments[5]};if(arguments[6]&&e.vel)e.vel.y=arguments[6];if(Array.prototype.indexOf.call(arguments,false)!==-1)e.addToStage=false;var t=arguments[0]=e}else if(typeof t!=="object")throw new Error("You must pass in either an object or multiple arguments src,x,y,vx,vy,width,height");if(!t.src)throw new Error("A G.Image must have a 'src' attribute.");var i={src:"",clip:{x:0,y:0,width:0,height:0}};var s=Array.prototype.slice.call(arguments,0);s[1]=typeof s[1]==="object"?_.extend(s[1],i):i;if(this._super)this._super.apply(this,s);this.image=new Image;this.image.src=this.src;this.loaded=false;var n=this;function r(){this.loaded=true;if(this.width===0)this.width=this.image.naturalWidth;if(this.height===0)this.height=this.image.naturalHeight;n.trigger("load")}this.image.addEventListener("load",function(){r.call(n)})},_render:function(e,i,s,n){var r=this.stage?this.stage.ctx:t.stage.ctx;if(!r)return;if(!this.loaded)return;if(e===undefined)var e=this.pos.x;if(i===undefined)var i=this.pos.y;if(s===undefined)var s=this.width;if(n===undefined)var n=this.height;if(this.clip.width!==0&&this.clip.height!==0){r.drawImage(this.image,this.clip.x,this.clip.y,this.clip.width,this.clip.height,e-s/2,i-n/2,s,n)}else{r.drawImage(this.image,e-s/2,i-n/2,s,n)}}});t.Line=s.extend({initialize:function(t){var e={pos:{x1:0,y1:0,x2:0,y2:0,x:0,y:0},thickness:1,endStyle:"butt"};if(typeof t!=="object"&&arguments.length>3){var i={};i.pos={x1:arguments[0],y1:arguments[1],x2:arguments[2],y2:arguments[3]};if(typeof arguments[4]==="string")i.color=arguments[4];if(typeof arguments[5]==="number")i.thickness=arguments[5];if(typeof arguments[6]==="number")i.vel={x:arguments[6]};if(typeof arguments[7]==="number"&&i.vel)i.vel.y=arguments[7];if(Array.prototype.indexOf.call(arguments,false)!==-1)i.addToStage=false;var t=arguments[0]=i}this.shape="line";arguments[1]=typeof arguments[1]==="object"?_.extend(arguments[1],e):e;if(this._super)this._super.apply(this,arguments);this.setDimensions().setCenter()},setCenter:function(t,e){if(t&&e){var i=(this.pos.x2+this.pos.x1)/2-t;this.pos.x1-=i;this.pos.x2-=i;var s=(this.pos.y2+this.pos.y1)/2-e;this.pos.y1-=s;this.pos.y2-=s}this.pos.x=typeof t!=="number"?(this.pos.x2+this.pos.x1)/2:t;this.pos.y=typeof e!=="number"?(this.pos.y2+this.pos.y1)/2:e;return this},setWidth:function(t){if(t){var e=(this.pos.x2-this.pos.x1)/2-t/2;this.pos.x1+=e,this.pos.x2-=e}this.width=typeof t!=="number"?this.pos.x2-this.pos.x1:t;return this},setHeight:function(t){if(t){var e=(this.pos.y2-this.pos.y1)/2-t/2;this.pos.y1+=e,this.pos.y2-=e}this.height=typeof t!=="number"?this.pos.y2-this.pos.y1:t;return this},setDimensions:function(t,e){this.setWidth(t).setHeight(e);return this},_render:function(e,i){var s=this.stage?this.stage.ctx:t.stage.ctx;if(!s)return;s.beginPath();s.moveTo(this.pos.x1,this.pos.y1);s.lineTo(this.pos.x2,this.pos.y2);s.strokeStyle=this.color;s.lineWidth=this.thickness;s.lineCap=this.endStyle;s.stroke();s.closePath()}});t.Polygon=s.extend({initialize:function(t){if(arguments.length>2&&Array.isArray(arguments[2])){var e={};e.pos={x:arguments[0],y:arguments[1]};e.vertices=arguments[2];if(typeof arguments[3]==="string")e.color=arguments[3];if(typeof arguments[4]==="number")e.vel={x:arguments[4]};if(typeof arguments[5]==="number"&&e.vel)e.vel.y=arguments[5];if(Array.prototype.indexOf.call(arguments,false)!==-1)e.addToStage=false;var t=arguments[0]=e}this.shape="polygon";var i={vertices:[]};arguments[1]=typeof arguments[1]==="object"?_.extend(arguments[1],i):i;this.relativeVertices=true;if(!t.pos||t.pos&&typeof t.pos.x!=="number"&&typeof t.pos.y!=="number")this.relativeVertices=false;if(this._super)this._super.apply(this,arguments);if(this.vertices.length<3)throw new Error("A line must have 3 or more vertices")},computeCentroid:function(e){var e=e?t.toVectors(e):t.toVectors(this.vertices);var i=e.length;var s=new t.Vector;var n=0;var r=0;var a=0;var o=0;var h=0;var f=0;var l=0;for(l=0;l<i-1;++l){r=e[l].x;a=e[l].y;o=e[l+1].x;h=e[l+1].y;f=r*h-o*a;n+=f;s.x+=(r+o)*f;s.y+=(a+h)*f}r=e[l].x;a=e[l].y;o=e[0].x;h=e[0].y;f=r*h-o*a;n+=f;s.x+=(r+o)*f;s.y+=(a+h)*f;n*=.5;s.x/=6*n;s.y/=6*n;return s},bounds:function(t){if(t){if(!this.pos||!this.pos.x||!this.pos.y)return false;var e=this.bounds(),i=this.pos.x-e.left,s=this.pos.y-e.top;if(typeof t.left==="number")this.pos.x=t.left+i;if(typeof t.right==="number")this.pos.x=t.right-i;if(typeof t.top==="number")this.pos.y=t.top+s;if(typeof t.bottom==="number")this.pos.y=t.bottom-s}else{var n=[],r=[];if(this.pos&&this.pos.x!==undefined&&this.pos.y!==undefined)for(var a=0;a<this.vertices.length-1;a+=2){n.push(this.pos.x+this.vertices[a]);r.push(this.pos.y+this.vertices[a+1])}else for(var a=0;a<this.vertices.length-1;a+=2){n.push(this.vertices[a]);r.push(this.vertices[a+1])}return{left:Math.min.apply(Math,n),right:Math.max.apply(Math,n),top:Math.min.apply(Math,r),bottom:Math.max.apply(Math,r)}}},_render:function(e,i){var s=this.stage?this.stage.ctx:t.stage.ctx;if(!s)return;if(this.fill)s.fillStyle=this.color;else s.strokeStyle=this.strokeColor||this.color;s.beginPath();if(this.pos&&this.relativeVertices){var e=typeof e==="number"?e:this.pos.x;var i=typeof i==="number"?i:this.pos.y}else{var e=typeof e==="number"?e:0;var i=typeof i==="number"?i:0}s.moveTo(e+this.vertices[0],i+this.vertices[1]);for(var n=2;n<this.vertices.length;n+=2){s.lineTo(e+this.vertices[n],i+this.vertices[n+1])}s.lineTo(e+this.vertices[0],i+this.vertices[1]);if(this.thickness)s.lineWidth=this.thickness;if(this.fill)s.fill();else s.stroke();s.closePath()}});t.Text=s.extend({initialize:function(t){if(typeof t!=="object"){var e={};e.text=arguments[0];if(typeof arguments[1]==="number")e.pos={x:arguments[1]};if(typeof arguments[2]==="number"&&e.pos)e.pos.y=arguments[2];if(typeof arguments[3]==="string")e.size=arguments[3];if(typeof arguments[4]==="string")e.font=arguments[4];if(typeof arguments[5]==="string")e.weight=arguments[5];if(arguments[6])e.color=arguments[6];if(typeof arguments[7]==="string")e.align=arguments[7];if(typeof arguments[8]==="string")e.baseline=arguments[8];if(Array.prototype.indexOf.call(arguments,false)!==-1)e.addToStage=false;var t=arguments[0]=e}this.shape="text";if(arguments[0].addToStage!==false)this.add();var i={text:"",size:"12px",font:"Helvetica",weight:"normal",pos:{x:0,y:0},rotation:0,color:"#000",collections:[],hidden:false,events:true};for(var s in i)this[s]=i[s];for(var s in arguments[0])this[s]=typeof arguments[0][s]==="object"?_.clone(arguments[0][s]):arguments[0][s]},_render:function(){var e=this.stage?this.stage.ctx:t.stage.ctx;if(!e)return;e.fillStyle=this.color;e.font=this.weight+" "+this.size+" "+this.font;if(this.align)e.textAlign=this.align;if(this.baseline)e.textBaseline=this.baseline;e.fillText(typeof this.text==="function"?this.text():this.text,this.pos.x,this.pos.y)}});var n=t.Physics={};var r=n.ShatialHash=function(){return t.Class.extend({initialize:function(e){var i=t.isMobile?10:20;var s=t.isMobile?30:60;this.cellSize=e?e:typeof t==="object"&&typeof t.canvas==="object"?t.canvas.height<t.canvas.width?t.canvas.width/i:t.canvas.height/i:s;this.buckets={}},hash:function(e,i){if(e instanceof t.Vector)return e.divide(this.cellSize).floor();return new t.Vector(e/this.cellSize,i/this.cellSize).floor()},insert:function(e){var i=this;if(e instanceof Array)_.each(e,function(t){i.insert(t)});else if(e instanceof t.Collection)e.each(function(t){i.insert(t)});else{if(!e.bounds)throw new Error("The object to insert must have a bounds function that returns {top,left,bottom,right}");var s=e.bounds();var n=this.hash(s.left,s.top);var r=this.hash(s.right,s.bottom);for(var a=n.x;a<=r.x;a++){for(var o=n.y;o<=r.y;o++){var h=a+":"+o;if(!this.buckets[h])this.buckets[h]=[];this.buckets[h].push(e)}}}return this},retrieve:function(t){if(!t)return this.retrieveAll();var e=t.bounds();var i=this.hash(e.left,e.top);var s=this.hash(e.right,e.bottom);var n=[];for(var r=i.x;r<s.x+1;r++){for(var a=i.y;a<s.y+1;a++){var o=r+":"+a;if(!this.buckets[o])continue;for(var h=0;h<this.buckets[o].length;h++){if(n.indexOf(this.buckets[o][h])===-1)n.push(this.buckets[o][h])}}}return n},retrieveAll:function(){var t=[];_.each(this.buckets,function(e){for(var i=0;i<e.length;i++){if(t.indexOf(e[i])===-1)t.push(e[i])}});return t},remove:function(t){if(!t)return;var e=t.bounds();var i=this.hash(e.left,e.top);var s=this.hash(e.right,e.bottom);for(var n=i.x;n<s.x+1;n++){for(var r=i.y;r<s.y+1;r++){var a=n+":"+r;var o=this.buckets[a]?this.buckets[a].indexOf(t):-1;if(this.buckets[a]&&o!==-1){this.buckets[a].splice(o,1);if(this.buckets[a].length===0)delete this.buckets[a]}}}return this},clear:function(){this.buckets={};return this},setCellSize:function(t){if(typeof t!=="number")return false;this.cellSize=t;this.reset();return this}})}();n.World=function(){var e=0,i={},s={acc:{x:0,y:0},restitution:0,friction:0,mass:1},n,a={update:function(){if(n&&n!==a.update)n.apply(this,arguments);if(this.type==="kinematic")a.kinematic.apply(this,arguments);else if(this.type==="dynamic")a.dynamic.apply(this,arguments)},kinematic:function(){var e=this;if(!(e.pos instanceof t.Vector)||!(e.vel instanceof t.Vector)){e.pos=new t.Vector(e.pos?e.pos.x:0,e.pos?e.pos.y:0);e.vel=new t.Vector(e.vel?e.vel.x:0,e.vel?e.vel.y:0)}e.pos.add(e.vel.multiply(e.stage?e.stage.deltaFramerate:1))},dynamic:function(){var e=this;if(!(e.pos instanceof t.Vector)||!(e.vel instanceof t.Vector)||!(e.acc instanceof t.Vector)){e.pos=new t.Vector(e.pos?e.pos.x:0,e.pos?e.pos.y:0);e.vel=new t.Vector(e.vel?e.vel.x:0,e.vel?e.vel.y:0);e.acc=new t.Vector(e.acc?e.acc.x:0,e.acc?e.acc.y:0)}e.vel.add(e.acc);e.pos.add(e.vel.multiply(e.stage?e.stage.deltaFramerate:1))}};return t.Class.extend({initialize:function(e){var i=this;e=e||{};this.setGravity(e.gravity);this.setCellSize(e.cellSize);this.collisions={dynamicdynamic:true,dynamicstatic:true,dynamickinematic:true};this.config(e);this.shapes={"static":new t.Collection(false,true),kinematic:new t.Collection(false,true),dynamic:new t.Collection(false,true),all:new t.Collection(false,true)};this.shapes.static.name="Static Collision Shapes";this.shapes.kinematic.name="Kinematic Collision Shapes";this.shapes.dynamic.name="Dynamic Collision Shapes";this.shapes.all.name="All Collision Shapes";n=t.Shape.prototype.update;if(n!==a.update)t.Shape.prototype.update=a.update},setCellSize:function(e){if(!e&&t.cellSize)e=t.cellSize;this.staticHash=this.staticHash instanceof r?this.staticHash.setCellSize(e):new r(e);this.kinematicHash=this.kinematicHash instanceof r?this.kinematicHash.setCellSize(e):new r(e);this.dynamicHash=this.dynamicHash instanceof r?this.dynamicHash.setCellSize(e):new r(e)},setGravity:function(e){var i=typeof e!=="undefined"?typeof e.x==="number"?e.x:typeof arguments[0]===number?arguments[0]:0:typeof t.gravity!=="undefined"?t.gravity.x:0;var s=typeof e!=="undefined"?typeof e.y==="number"?e.y:typeof arguments[1]===number?arguments[1]:0:typeof t.gravity!=="undefined"?t.gravity.y:0;this.gravity=new t.Vector(i,s)},config:function(t){var e=this;if(typeof t!=="object")return false;if(typeof t.gravity!=="undefined")this.setGravity(t.gravity);if(typeof t.collisions!=="undefined"){if(!t.collisions)this.collisions=false;else if(typeof t.collisions==="object"){_.each(t.collisions,function(t,i){if(t===false)e.collisions[i]=false})}}},add:function(e){if(e instanceof t.Text)return;if(e instanceof t.Collection)e.each(function(t){self.add(t)});else if(!(e instanceof t.Shape)||e instanceof t.Shape&&e.physics===false)return false;if(!e.type){if(e.shape==="line")e.type="static";else e.type="dynamic"}this.shapes.all.add(e);if(e.type==="static"){this.shapes.static.add(e);this.staticHash.insert(e)}if(e.type==="kinematic"){this.shapes.kinematic.add(e);this.kinematicHash.insert(e)}if(e.type==="dynamic"){this.shapes.dynamic.add(e);this.dynamicHash.insert(e)}_.each(s,function(t,i){e[i]=typeof e[i]==="undefined"?t:e[i]});_.each(i,function(t,i){e[i]=e[i]||t});return this},remove:function(e){if(!(e instanceof t.Shape))return false;if(this.shapes.all.has(e))this.shapes.all.remove(e);else return false;if(e.type==="static"){this.shapes.static.remove(e);this.staticHash.remove(e)}else if(e.type==="kinematic"){this.shapes.kinematic.remove(e);this.kinematicHash.remove(e)}else if(e.type==="dynamic"){this.shapes.dynamic.remove(e);this.dynamicHash.remove(e)}_.each(e,function(t,s){if(s in i)delete e[s]});return this},update:function(){var t=this;if(this.collisions.dynamicstatic!==false)t.staticHash.clear().insert(t.shapes.static);if(this.collisions.dynamickinematic!==false)t.kinematicHash.clear().insert(t.shapes.kinematic);if(this.collisions.dynamicdynamic!==false||this.collisions.dynamicstatic!==false)t.dynamicHash.clear().insert(t.shapes.dynamic);if(t.collisions.dynamicstatic&&t.collisions!==false&&t.shapes.dynamic.length()>=t.shapes.static.length()){t.shapes.static.each(function(e){if(e.enableCollisions===false||e.physics===false)return;_.each(t.dynamicHash.retrieve(e),function(i){if(i.physics===false||i.enableCollisions===false)return;t.handleCollisions(e,i)})})}t.shapes.kinematic.each(function(e){if(e.type!=="kinematic"){t.shapes.kinematic.remove(e);e.type==="static"?t.shapes.static.add(e):t.shapes.dynamic.add(e);return}if(e.physics===false)return;e.update();if(t.collisions!==false&&e.enableCollisions!==false&&t.collisions.dynamickinematic&&t.shapes.dynamic.length()>=t.shapes.kinematic.length()){_.each(t.dynamicHash.retrieve(e),function(i){if(i.physics===false||i.enableCollisions===false)return;t.handleCollisions(e,i)})}});t.shapes.dynamic.each(function(e){if(e.type!=="dynamic"){t.shapes.dynamic.remove(e);e.type==="static"?t.shapes.static.add(e):t.shapes.kinematic.add(e);return}if(e.physics===false)return;if(e.gravity!==false)e.acc=t.gravity;e.update();if(t.collisions!==false&&e.enableCollisions!==false){if(t.collisions.dynamicstatic&&t.shapes.dynamic.length()<t.shapes.static.length()){_.each(t.staticHash.retrieve(e),function(i){if(i.physics===false||i.enableCollisions===false)return;t.handleCollisions(e,i)})}if(t.collisions.dynamickinematic&&t.shapes.dynamic.length()<t.shapes.kinematic.length()){_.each(t.kinematicHash.retrieve(e),function(i){if(i.physics===false||i.enableCollisions===false)return;t.handleCollisions(e,i)})}if(t.collisions.dynamicdynamic){_.each(t.dynamicHash.retrieve(e),function(i){if(i.physics===false||i.enableCollisions===false)return;t.handleCollisions(e,i)})}}})},handleCollisions:function(e,i){var s=this;if(!e||!i||e===i||e.type!=="dynamic"&&i.type!=="dynamic")return false;if(i.type!=="dynamic"){var n=i;i=e;e=n}if(e.events)var r=e.trigger("collisionCheck",[i]);if(i.events)var a=i.trigger("collisionCheck",[e]);if(r instanceof Array&&r.indexOf(false)!==-1||a instanceof Array&&a.indexOf(false)!==-1)return true;var o=t.intersecting(e,i);if(!o)return false;if(e.type!=="dynamic"){if(e.events)var r=e.trigger("collision",[i,o]);if(i.events)var a=i.trigger("collision",[e,o])}else{if(e.events)var r=e.trigger("collision",[i,o.divide(2).multiply(-1)]);if(i.events)var a=i.trigger("collision",[e,o.divide(2)])}if(r instanceof Array&&r.indexOf(false)!==-1||a instanceof Array&&a.indexOf(false)!==-1)return true;var h=e.restitution||i.restitution?1*e.restitution*i.restitution?1*e.restitution*i.restitution:Math.max(e.restitution,i.restitution):1;var f=(e.friction+i.friction)/2;if(e.type!=="dynamic"){i.pos.add(o);if(i.rotation===0&&e.rotation===0){if(i.vel.x!==0&&Math.abs(o.x)>0)i.vel.x*=-1*h;if(i.vel.y!==0&&Math.abs(o.y)>0)i.vel.y*=-1*h;if(i.vel.x<0&&f){i.vel.x*=1-f/10;if(i.vel.x>-.01)i.vel.x=0}else if(i.vel.x>0&&f){i.vel.x*=1-f/10;if(i.vel.x<.01)i.vel.x=0}}}else{i.pos.add(o.divide(2));e.pos.subtract(o.divide(2));if((i.shape==="circle"||i.shape==="rect")&&i.rotation===0){if(i.vel.x!==0&&o.x!==0){var n=e.vel.x;e.vel.x=i.vel.x;i.vel.x=n;i.vel.x*=1*h;e.vel.x*=1*h}if(i.vel.y!==0&&o.y!==0){var n=e.vel.y;e.vel.y=i.vel.y;i.vel.y=n;i.vel.y*=1*h;e.vel.y*=1*h}f;if(i.vel.x<0&&f){i.vel.x*=1-f/10;if(i.vel.x>-.001)i.vel.x=0}else if(i.vel.x>0&&f){i.vel.x*=1-f/10;if(i.vel.x<.001)i.vel.x=0}if(e.vel.x<0&&f){e.vel.x*=1-f/10;if(e.vel.x>-.001)e.vel.x=0}else if(e.vel.x>0&&f){e.vel.x*=1-f/10;if(e.vel.x<.001)e.vel.x=0}}}}})}();t.intersecting=function(){function e(e,i,s){var n=i.x+((e.x-i.x)*Math.cos(s)-(e.y-i.y)*Math.sin(s));var r=i.y+((e.x-i.x)*Math.sin(s)+(e.y-i.y)*Math.cos(s));return new t.Vector(n,r)}return function(i,s,n){if(s instanceof t.Vector)s=new t.Circle(s.x,s.y,.1,false);if(i instanceof t.Collection){}else if(i instanceof Array){var r=false;_.each(i,function(e){if(!(e instanceof t.Shape))return;if(s instanceof t.Shape){var a=t.intersecting(e,s,n)}else _.each(i,function(i){if(i instanceof t.Shape)var n=t.intersecting(e,i,s);if(n)r=n;if(r)return false});if(a)r=a;if(r)return false});return r}if(i===s)return false;if(!o(i,s))return false;if(s.shape==="static"){var a=s;s=i;i=a}if(i.shape==="circle"&&s.shape==="circle")return h(i,s);else if(i.shape!=="circle"&&s.shape!=="circle")return f(i,s);else if(i.shape==="circle"||s.shape==="circle")return l(i,s);else return false;function o(t,e){if(t.shape==="circle"||t.shape==="rect")return e.pos.x-e.width/2<t.pos.x+t.width/2&&e.pos.x+e.width/2>t.pos.x-t.width/2&&e.pos.y-e.height/2<t.pos.y+t.height/2&&e.pos.y+e.height/2>e.pos.y-e.height/2;var i=t.bounds(),s=e.bounds();return s.left<i.right&&s.right>i.left&&s.top<i.bottom&&s.bottom>s.top}function h(e,i){var s=e.pos.x,n=e.pos.y,r=i.pos.x,a=i.pos.y,o=e.radius,h=i.radius;var f=Math.pow(r-s,2)+Math.pow(a-n,2);var l=f<Math.pow(o+h,2);if(!l)return false;var u=h+o-Math.sqrt(f);var c=new t.Vector(r-s,a-n).normalize();return new t.Vector(c.x*(u+.01),c.y*(u+.01))}function f(e,i){var s=u(e),n=u(i);var r=Number.MAX_VALUE;for(var a=0;a<s.length;a++){var o=new t.Vector((s[a+1]?s[a+1].x:s[0].x)-s[a].x,(s[a+1]?s[a+1].y:s[0].y)-s[a].y);var h=new t.Vector(-o.y,o.x).normalize();var f=c(h,s);var l=c(h,n);if(f[0]>=l[1]||l[0]>=f[1])return false;var p=(l[1]-f[0])*-1;var d=Math.abs(p);if(d<r){r=d;mtv=new t.Vector(h.x*(p-.01),h.y*(p-.01))}}for(var a=0;a<n.length;a++){var o=new t.Vector((n[a+1]?n[a+1].x:n[0].x)-n[a].x,(n[a+1]?n[a+1].y:n[0].y)-n[a].y);var h=new t.Vector(-o.y,o.x).normalize();var f=c(h,s);var l=c(h,n);if(f[0]>=l[1]||l[0]>=f[1])return false;var p=l[1]-f[0];var d=Math.abs(p);if(d<r){r=d;mtv=new t.Vector(h.x*(p-.01),h.y*(p-.01))}}if(typeof mtv==="undefined")console.log(e,i);return mtv}function l(e,i){var s=e.shape==="circle"?e:i;var n=e.shape==="circle"?i:e;var r=u(n);var a=Number.MAX_VALUE;var o=s.pos.x,h=s.pos.y;var f=r[0];var l=Math.pow(s.pos.x-f.x,2)+Math.pow(s.pos.y-f.y,2);for(var p=1;p<r.length;p++){var d=r[p];var v=Math.pow(s.pos.x-d.x,2)+Math.pow(s.pos.y-d.y,2);if(v<l){l=v;f=r[p]}}var g=new t.Vector(o-f.x,h-f.y).normalize();var y=c(g,r);var m=c(g,s);if(y[0]>m[1]||m[0]>y[1])return false;if(s===arguments[0])var x=m[1]-y[0];else var x=(m[1]-y[0])*-1;var w=Math.abs(x);a=w;mtv=new t.Vector(g.x*(s===e?x+.01:x-.01),g.y*(s===e?x+.01:x-.01));for(var p=0;p<r.length;p++){var b=new t.Vector((r[p+1]?r[p+1].x:r[0].x)-r[p].x,(r[p+1]?r[p+1].y:r[0].y)-r[p].y);var g=new t.Vector(-b.y,b.x).normalize();var y=c(g,r);var m=c(g,s);if(y[0]>m[1]||m[0]>y[1])return false;if(s===arguments[0])var x=m[1]-y[0];else var x=(m[1]-y[0])*-1;var w=Math.abs(x);if(w<a){a=w;mtv=new t.Vector(g.x*(s===e?x+.01:x-.01),g.y*(s===e?x+.01:x-.01))}}return mtv}function u(i){var s=[];if(i.shape==="line"){var r=new t.Vector(i.pos.x2-i.pos.x1,i.pos.y2-i.pos.y1);var a=new t.Vector(-r.y,r.x).normalize(.01);s=[i.pos.x1,i.pos.y1,i.pos.x2,i.pos.y2,i.pos.x2+a.x,i.pos.y2+a.y,i.pos.x1+a.x,i.pos.y1+a.y]}else if(i.shape==="polygon"){for(var o=0;o<i.vertices.length-1;o+=2)s.push((i.pos.x||0)+i.vertices[o],(i.pos.y||0)+i.vertices[o+1]);if(n){var h=[],f=s;for(var o=f.length-1;o>0;o-=2){h.push(f[o-1],f[o])}s=h}}else if(i.shape==="rect"){var l=i.width/2,u=i.height/2;s=[i.pos.x-l,i.pos.y-u,i.pos.x+l,i.pos.y-u,i.pos.x+l,i.pos.y+u,i.pos.x-l,i.pos.y+u]}else throw new Error("Shape does not contain vertices");var c=[];for(var o=0;o<s.length;o+=2)c.push(new t.Vector(s[o],s[o+1]));if(i.rotation!==0){for(var o=0;o<c.length;o++){c[o]=e(c[o],i.pos,i.rotation)}}return c}function c(t,e){var i,s;if(e.shape==="circle"){var n=e;s=t.dot(n.pos)-n.radius;i=s+n.radius*2}else{i=s=t.dot(e[0]);for(var r=0;r<e.length;r++){var a=t.dot(e[r]);if(a<s)s=a;if(a>i)i=a}}return[s,i]}}}();t.toDegrees=function(t){return t*(180/Math.PI)};t.toRadians=function(t){return t*(Math.PI/180)};t.random=function(t,e){var e=typeof e==="number"?e:0;var t=typeof t==="number"?t:1;return Math.round(e+Math.random()*(t-e))};t.random.float=function(t,e){var e=typeof e==="number"?e:0;var t=typeof t==="number"?t:1;return e+Math.random()*(t-e)};t.random.color=function(){return"rgb("+t.random(255)+","+t.random(255)+","+t.random(255)+")"};t.random.choice=function(e){if(Array.isArray(e))return e[t.random(e.length-1)];return arguments[t.random(arguments.length-1)]};function a(t){return Date.now()-t}function o(t){return Math.ceil(1e3/(Date.now()-t))}function h(t,e,i){var e=e||60;var i=i||1;var s=o(t);var n=e/s*i;return n}t.Vector=function(t,e){this.x=typeof t==="number"?t:0;this.y=typeof e==="number"?e:0};t.Vector.prototype.dot=function(t){return this.x*t.x+this.y*t.y};t.Vector.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};t.Vector.prototype.normalize=function(t){var e=(t||1)/this.length();this.x*=e;this.y*=e;return this};t.Vector.prototype.add=function(e,i){if(!i&&e instanceof t.Vector){var s=e;e=s.x,i=s.y}if(e)this.x+=e;if(i)this.y+=i;return this};t.Vector.prototype.plus=function(){return this.add.apply(new t.Vector(this.x,this.y),arguments)};t.Vector.prototype.subtract=function(e,i){if(!i&&e instanceof t.Vector){var s=e;e=s.x,i=s.y}if(e)this.x-=e;if(i)this.y-=i;return this};t.Vector.prototype.minus=function(){return this.subtract.apply(new t.Vector(this.x,this.y),arguments)};t.Vector.prototype.multiply=function(e){return new t.Vector(this.x*e,this.y*e)};t.Vector.prototype.divide=function(e){return new t.Vector(this.x/e,this.y/e)};t.Vector.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};t.Vector.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};t.Vector.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};t.Vector.prototype.set=function(e,i){if(!i&&e instanceof t.Vector){var s=e;e=s.x,i=s.y}if(typeof e==="number")this.x=e;if(typeof i==="number")this.y=i;return this};t.toVectors=function(e){if(e[0]&&e[0]instanceof t.Vector)return e;e=e.map(function(e,i,s){if(i%2===0)return new t.Vector(e,s[i+1])});for(var i=e.length;i>0;i--)if(typeof e[i]==="undefined")e.splice(i,1);return e};Emit.mixin(t);Emit.mixin(t.Collection);Emit.mixin(t.Shape);Emit.mixin(t.Ticker);t.events=true;t.stages=[];t.collections=[];t.isMobile=function(){try{document.createEvent("TouchEvent");return true}catch(t){return false}}();t.event=new e;if(t.isMobile)t.event.mouse.onlyTouch().on("touchstart,touchend,touchmove",function(t){t.preventDefault()});return t});